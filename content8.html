<script>
// ==========================
// üîä iPHONE-KOMPATIBILIS MAGYAR TTS
// ==========================

let utterance = null;
let paused = false;
let fullText = "";
let magyarHang = null;

// üî• 1) Magyar hang lek√©r√©se ‚Äî iPhone miatt k√∂telez≈ë
function hangBetoltes() {
    const voices = speechSynthesis.getVoices();

    // megkeress√ºk a magyar hangot
    magyarHang = voices.find(v =>
        v.lang.toLowerCase() === "hu-hu" ||
        v.lang.toLowerCase().startsWith("hu")
    );

    // ha nincs magyar hang, akkor is be√°ll√≠tjuk lang-re, ez seg√≠t
    if (!magyarHang) {
        console.log("Nincs kifejezett magyar hang, lang=hu-HU lesz haszn√°lva.");
    }
}

// iPhone miatt sz√ºks√©ges: a hangok k√©s≈ëbb √©rkeznek meg
speechSynthesis.onvoiceschanged = hangBetoltes;
hangBetoltes();

// üîé teljes sz√∂veg kigy≈±jt√©se
function getText() {
    const container = document.querySelector(".container");
    let text = "";
    container.querySelectorAll("p, h1, h2, li").forEach(el => {
        text += el.innerText + " ";
    });
    return text;
}

// üîä Felolvas√°s ind√≠t√°sa
function felolvas() {
    speechSynthesis.cancel();
    paused = false;

    fullText = getText();

    utterance = new SpeechSynthesisUtterance(fullText);

    // iPhone-on ez a kulcs:
    utterance.lang = "hu-HU";
    if (magyarHang) utterance.voice = magyarHang;

    speechSynthesis.speak(utterance);
}

// ‚è∏ Sz√ºnet / ‚ñ∂ Folytat√°s
function szunetFolytat() {
    if (!utterance) return;

    if (!paused) {
        speechSynthesis.pause();
        paused = true;
    } else {
        speechSynthesis.resume();
        paused = false;
    }
}

// ‚õî Le√°ll√≠t√°s
function leallit() {
    speechSynthesis.cancel();
    paused = false;
}

// ‚è™ Vissza (10% ugr√°s)
function elozo() {
    if (!fullText) return;
    speechSynthesis.cancel();

    let pos = Math.floor(fullText.length * 0.1);
    let newText = fullText.substring(Math.max(0, fullText.length - pos));

    utterance = new SpeechSynthesisUtterance(newText);
    utterance.lang = "hu-HU";
    if (magyarHang) utterance.voice = magyarHang;

    speechSynthesis.speak(utterance);
}

// ‚è© El≈ëre (10% ugr√°s)
function kov() {
    if (!fullText) return;
    speechSynthesis.cancel();

    let pos = Math.floor(fullText.length * 0.1);
    let newText = fullText.substring(pos);

    utterance = new SpeechSynthesisUtterance(newText);
    utterance.lang = "hu-HU";
    if (magyarHang) utterance.voice = magyarHang;

    speechSynthesis.speak(utterance);
}
</script>
